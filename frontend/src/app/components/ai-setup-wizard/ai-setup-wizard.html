<div class="wizard-backdrop">
  <div class="wizard-container">
    <!-- Close Button -->
    <button class="close-btn" (click)="skipSetup()" title="Close">√ó</button>

    <!-- Progress Indicator -->
    <div class="progress-dots" *ngIf="currentStep() !== 'welcome'">
      <span class="dot" [class.active]="currentStep() !== 'done'" [class.completed]="currentStep() === 'done'"></span>
      <span class="dot" [class.active]="currentStep() === 'done'"></span>
    </div>

    <!-- ==================== WELCOME STEP ==================== -->
    @if (currentStep() === 'welcome') {
      <div class="wizard-step welcome-step">
        <div class="step-header">
          <span class="step-icon">üöÄ</span>
          <h2 class="step-title">AI Features Setup</h2>
          <p class="step-subtitle">Configure AI for smart metadata generation</p>
        </div>

        <div class="info-banner">
          <span class="banner-icon">üí°</span>
          <div class="banner-content">
            <strong>AI setup is optional</strong>
            <p>You can generate metadata manually without AI configuration.</p>
          </div>
        </div>

        <div class="feature-preview">
          <h3>AI-Powered Features</h3>
          <div class="features-grid">
            <div class="feature-item">
              <span class="feature-icon">üìù</span>
              <span>Auto Titles</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üìã</span>
              <span>Descriptions</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üè∑Ô∏è</span>
              <span>Smart Tags</span>
            </div>
            <div class="feature-item">
              <span class="feature-icon">üìä</span>
              <span>Metadata</span>
            </div>
          </div>
        </div>

        <h3 class="section-title">Choose a Provider</h3>

        <div class="provider-cards">
          <!-- Ollama Card -->
          <div class="provider-card recommended" (click)="selectProvider('ollama')">
            <div class="card-badge">Recommended</div>
            <div class="card-header">
              <span class="card-icon">üíª</span>
              <div class="card-titles">
                <h4>Ollama</h4>
                <span class="card-tagline">Free & Private</span>
              </div>
            </div>
            <ul class="card-features">
              <li class="pro"><span>‚úì</span> No API costs ever</li>
              <li class="pro"><span>‚úì</span> Data stays on your machine</li>
              <li class="pro"><span>‚úì</span> Works offline</li>
              <li class="con"><span>‚úó</span> 2+ GB download required</li>
            </ul>
            <button class="card-btn primary">Configure Ollama</button>
          </div>

          <!-- Claude Card -->
          <div class="provider-card" (click)="selectProvider('claude')">
            <div class="card-header">
              <span class="card-icon">üß†</span>
              <div class="card-titles">
                <h4>Claude API</h4>
                <span class="card-tagline">Best Quality</span>
              </div>
            </div>
            <ul class="card-features">
              <li class="pro"><span>‚úì</span> Highest quality results</li>
              <li class="pro"><span>‚úì</span> No installation needed</li>
              <li class="pro"><span>‚úì</span> Fast processing</li>
              <li class="con"><span>‚úó</span> ~$0.002-0.01 per video</li>
            </ul>
            <button class="card-btn">Configure Claude</button>
          </div>

          <!-- OpenAI Card -->
          <div class="provider-card" (click)="selectProvider('openai')">
            <div class="card-header">
              <span class="card-icon">‚ö°</span>
              <div class="card-titles">
                <h4>OpenAI API</h4>
                <span class="card-tagline">Fast & Reliable</span>
              </div>
            </div>
            <ul class="card-features">
              <li class="pro"><span>‚úì</span> Good quality results</li>
              <li class="pro"><span>‚úì</span> No installation needed</li>
              <li class="pro"><span>‚úì</span> Very fast</li>
              <li class="con"><span>‚úó</span> ~$0.005-0.02 per video</li>
            </ul>
            <button class="card-btn">Configure OpenAI</button>
          </div>
        </div>

        <div class="step-footer">
          <button class="skip-btn" (click)="skipSetup()">
            Skip for now
          </button>
        </div>
      </div>
    }

    <!-- ==================== OLLAMA STEP ==================== -->
    @if (currentStep() === 'ollama') {
      <div class="wizard-step ollama-step">
        <button class="back-btn" (click)="goBack()">
          <span>‚Üê</span> Back
        </button>

        <div class="step-header">
          <span class="step-icon">üíª</span>
          <h2 class="step-title">Install Ollama</h2>
          <p class="step-subtitle">Set up local AI on your {{ platform() }} machine</p>
        </div>

        <div class="instruction-card">
          <h3>Installation Steps</h3>
          <ol class="instruction-list">
            @for (step of getInstallInstructions(); track step) {
              <li>{{ step }}</li>
            }
          </ol>
          <button class="action-btn primary" (click)="openOllamaWebsite()">
            <span>üåê</span> Open Ollama Website
          </button>
        </div>

        <div class="api-input-section">
          <label for="ollama-host">Ollama Server Address</label>
          <div class="input-wrapper">
            <input
              id="ollama-host"
              type="text"
              placeholder="http://localhost:11434"
              [value]="ollamaHost()"
              (input)="ollamaHost.set($any($event.target).value)"
            />
            <span class="input-icon">üåê</span>
          </div>
          <p class="input-hint">Default: http://localhost:11434 (leave as-is unless using a remote Ollama server)</p>
        </div>

        <div class="models-section">
          <h3>Download a Model</h3>
          <p class="models-hint">
            <span class="hint-icon">‚ÑπÔ∏è</span>
            After installing Ollama, open Terminal and run one of these commands
          </p>

          <div class="model-cards">
            @for (model of recommendedModels; track model.name) {
              <div class="model-card" [class.recommended]="model.recommended">
                @if (model.recommended) {
                  <div class="model-badge">Best Choice</div>
                }
                <div class="model-header">
                  <h4>{{ model.name }}</h4>
                  <span class="model-size">{{ model.size }}</span>
                </div>
                <p class="model-ram">{{ model.ramRequirement }}</p>
                <p class="model-desc">{{ model.description }}</p>
                <div class="model-actions">
                  <code class="command clickable" (click)="copyCommand(model.pullCommand)" title="Click to copy">
                    {{ model.pullCommand }}
                  </code>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="status-section">
          <button
            class="check-btn"
            (click)="checkOllama()"
            [disabled]="isCheckingOllama()"
          >
            @if (isCheckingOllama()) {
              <span class="spinner"></span> Checking...
            } @else {
              Check Ollama Status
            }
          </button>

          @if (ollamaAvailable()) {
            <div class="status-result success">
              <span>‚úì</span> Ollama is running with {{ ollamaModels().length }} model(s)
            </div>
          }
        </div>

        <div class="step-footer">
          <button class="skip-btn" (click)="skipSetup()">Skip for now</button>
          @if (ollamaAvailable() && ollamaModels().length > 0) {
            <button class="action-btn primary" (click)="goToStep('done')">
              Continue
            </button>
          }
        </div>
      </div>
    }

    <!-- ==================== CLAUDE STEP ==================== -->
    @if (currentStep() === 'claude') {
      <div class="wizard-step api-step">
        <button class="back-btn" (click)="goBack()">
          <span>‚Üê</span> Back
        </button>

        <div class="step-header">
          <span class="step-icon">üß†</span>
          <h2 class="step-title">Claude API Setup</h2>
          <p class="step-subtitle">Connect to Anthropic's Claude API</p>
        </div>

        <div class="instruction-card">
          <h3>Get Your API Key</h3>
          <ol class="instruction-list">
            <li>Sign up or log in to Anthropic Console</li>
            <li>Navigate to API Keys section</li>
            <li>Click "Create Key"</li>
            <li>Copy the key and paste below</li>
          </ol>
          <button class="action-btn" (click)="openClaudeWebsite()">
            <span>üåê</span> Open Anthropic Console
          </button>
        </div>

        <div class="api-input-section">
          <label for="claude-key">Claude API Key</label>
          <div class="input-wrapper">
            <input
              id="claude-key"
              type="password"
              placeholder="sk-ant-api03-..."
              [value]="claudeApiKey()"
              (input)="claudeApiKey.set($any($event.target).value)"
            />
            <span class="input-icon">üîë</span>
          </div>
          <p class="input-hint">Your key is stored locally and never sent anywhere except Anthropic</p>
        </div>

        <div class="step-footer">
          <button class="skip-btn" (click)="skipSetup()">Skip for now</button>
          <button
            class="action-btn primary"
            (click)="saveClaudeKey()"
            [disabled]="!claudeApiKey() || isSavingKeys()"
          >
            @if (isSavingKeys()) {
              <span class="spinner"></span> Saving...
            } @else {
              Save & Continue
            }
          </button>
        </div>
      </div>
    }

    <!-- ==================== OPENAI STEP ==================== -->
    @if (currentStep() === 'openai') {
      <div class="wizard-step api-step">
        <button class="back-btn" (click)="goBack()">
          <span>‚Üê</span> Back
        </button>

        <div class="step-header">
          <span class="step-icon">‚ö°</span>
          <h2 class="step-title">OpenAI API Setup</h2>
          <p class="step-subtitle">Connect to OpenAI's GPT API</p>
        </div>

        <div class="instruction-card">
          <h3>Get Your API Key</h3>
          <ol class="instruction-list">
            <li>Sign up or log in to OpenAI Platform</li>
            <li>Navigate to API Keys page</li>
            <li>Click "Create new secret key"</li>
            <li>Copy the key and paste below</li>
          </ol>
          <button class="action-btn" (click)="openOpenAIWebsite()">
            <span>üåê</span> Open OpenAI Platform
          </button>
        </div>

        <div class="api-input-section">
          <label for="openai-key">OpenAI API Key</label>
          <div class="input-wrapper">
            <input
              id="openai-key"
              type="password"
              placeholder="sk-..."
              [value]="openaiApiKey()"
              (input)="openaiApiKey.set($any($event.target).value)"
            />
            <span class="input-icon">üîë</span>
          </div>
          <p class="input-hint">Your key is stored locally and never sent anywhere except OpenAI</p>
        </div>

        <div class="step-footer">
          <button class="skip-btn" (click)="skipSetup()">Skip for now</button>
          <button
            class="action-btn primary"
            (click)="saveOpenAIKey()"
            [disabled]="!openaiApiKey() || isSavingKeys()"
          >
            @if (isSavingKeys()) {
              <span class="spinner"></span> Saving...
            } @else {
              Save & Continue
            }
          </button>
        </div>
      </div>
    }

    <!-- ==================== DONE STEP ==================== -->
    @if (currentStep() === 'done') {
      <div class="wizard-step done-step">
        <div class="step-header">
          <span class="step-icon success">‚ú®</span>
          <h2 class="step-title">All Set!</h2>
          <p class="step-subtitle">AI features are ready to use</p>
        </div>

        <div class="success-card">
          <h3>Active Providers</h3>
          <div class="provider-list">
            @if (ollamaAvailable() && ollamaModels().length > 0) {
              <div class="provider-item">
                <span class="check-icon">‚úì</span>
                <div>
                  <strong>Ollama</strong>
                  <span>{{ ollamaModels().length }} model(s) available</span>
                </div>
              </div>
            }
            @if (claudeKeySet()) {
              <div class="provider-item">
                <span class="check-icon">‚úì</span>
                <div>
                  <strong>Claude API</strong>
                  <span>Ready to use</span>
                </div>
              </div>
            }
            @if (openaiKeySet()) {
              <div class="provider-item">
                <span class="check-icon">‚úì</span>
                <div>
                  <strong>OpenAI API</strong>
                  <span>Ready to use</span>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="next-steps-card">
          <h3>What's Next?</h3>
          <ul class="next-steps-list">
            <li>
              <span>üé¨</span>
              <span>Upload videos for metadata generation</span>
            </li>
            <li>
              <span>üìù</span>
              <span>Get AI-generated titles and descriptions</span>
            </li>
            <li>
              <span>üè∑Ô∏è</span>
              <span>Auto-generate tags and hashtags</span>
            </li>
            <li>
              <span>‚öôÔ∏è</span>
              <span>Configure models in Settings for optimal results</span>
            </li>
          </ul>
        </div>

        <div class="step-footer centered">
          <button class="action-btn primary large" (click)="complete()">
            Get Started
          </button>
        </div>
      </div>
    }
  </div>
</div>
