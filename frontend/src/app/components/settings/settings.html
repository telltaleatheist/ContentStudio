<div class="settings-wrapper">
  <!-- Save Notification -->
  @if (showSaveNotification()) {
    <div class="save-notification">
      <mat-icon>check_circle</mat-icon>
      <span>Settings saved successfully</span>
      <button mat-icon-button (click)="dismissSaveNotification()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  }

  <!-- Scrollable Content -->
  <div class="settings-container">
    <!-- Header -->
    <div class="header">
      <h2>Settings</h2>
    </div>

    <!-- AI Model Section -->
    <mat-card class="settings-card">
    <mat-card-header>
      <div class="card-header-content">
        <div>
          <mat-card-title>AI Models</mat-card-title>
          <mat-card-subtitle>Configure separate models for summarization and metadata generation</mat-card-subtitle>
        </div>
        <button mat-stroked-button (click)="openWizard()" class="wizard-button">
          <mat-icon>auto_awesome</mat-icon>
          Setup Wizard
        </button>
      </div>
    </mat-card-header>
    <mat-card-content>
      <!-- Summarization Model -->
      <div class="model-section">
        <h4 class="section-title">Summarization Model</h4>
        <p class="section-description">Fast model for condensing long transcripts (recommended: small local model)</p>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Summarization Model</mat-label>
          <mat-select [(value)]="summarizationModel">
            @for (option of modelOptions(); track option.value) {
              <mat-option [value]="option.value">
                <div class="model-option">
                  <mat-icon [class.cloud-icon]="option.provider === 'cloud'" [class.local-icon]="option.provider === 'local'">
                    {{ option.icon }}
                  </mat-icon>
                  <span>{{ option.label }}</span>
                </div>
              </mat-option>
            }
          </mat-select>
          <mat-hint>Used to condense transcripts before final metadata generation</mat-hint>
        </mat-form-field>
      </div>

      <!-- Metadata Generation Model -->
      <div class="model-section">
        <h4 class="section-title">Metadata Generation Model</h4>
        <p class="section-description">High-quality model for creating titles, descriptions, tags (recommended: large model or API)</p>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Metadata Generation Model</mat-label>
          <mat-select [(value)]="metadataModel">
            @for (option of modelOptions(); track option.value) {
              <mat-option [value]="option.value">
                <div class="model-option">
                  <mat-icon [class.cloud-icon]="option.provider === 'cloud'" [class.local-icon]="option.provider === 'local'">
                    {{ option.icon }}
                  </mat-icon>
                  <span>{{ option.label }}</span>
                </div>
              </mat-option>
            }
          </mat-select>
          <mat-hint>Used for final metadata creation from summaries</mat-hint>
        </mat-form-field>
      </div>

    </mat-card-content>
  </mat-card>

  <!-- Prompt Set Section -->
  <mat-card class="settings-card">
    <mat-card-header>
      <mat-card-title>Prompt Set</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Active Prompt Set</mat-label>
        <mat-select [(ngModel)]="selectedPromptSet">
          @for (promptSet of availablePromptSets(); track promptSet.id) {
            <mat-option [value]="promptSet.id">
              <div class="prompt-set-option">
                <mat-icon>{{ promptSet.platform === 'youtube' ? 'video_library' : 'podcasts' }}</mat-icon>
                <span>{{ promptSet.name }}</span>
              </div>
            </mat-option>
          }
        </mat-select>
        <mat-hint>Select which prompt set to use for generating metadata</mat-hint>
      </mat-form-field>

      <mat-card class="info-card">
        <mat-card-content>
          <div class="info-content">
            <mat-icon class="info-icon">info</mat-icon>
            <div>
              <p><strong>About Prompt Sets</strong></p>
              <p class="small">Each prompt set contains custom instructions for generating metadata. You can create and manage prompt sets in the Prompts page.</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-card-content>
  </mat-card>

  <!-- Output Directory Section -->
  <mat-card class="settings-card">
    <mat-card-header>
      <mat-card-title>Output Settings</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Output Directory</mat-label>
        <input matInput [(ngModel)]="outputDirectory" readonly>
        <button mat-icon-button matSuffix (click)="selectOutputDirectory()">
          <mat-icon>folder_open</mat-icon>
        </button>
        <mat-hint>Where generated metadata files will be saved</mat-hint>
      </mat-form-field>
    </mat-card-content>
  </mat-card>
  </div>

  <!-- Save Button (outside scrollable area) -->
  <div class="save-section">
    <button mat-raised-button color="primary" class="save-button" (click)="saveSettings()">
      <mat-icon>save</mat-icon>
      Save Settings
    </button>
  </div>

  <!-- AI Setup Wizard -->
  @if (showWizard()) {
    <app-ai-setup-wizard
      (closed)="closeWizard()"
      (completed)="wizardCompleted()">
    </app-ai-setup-wizard>
  }
</div>