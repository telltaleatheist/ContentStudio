<div class="page-container">
  <!-- Left Panel: Prompt Sets List -->
  <div class="list-panel">
    <div class="panel-header">
      <div class="header-left">
        <h2 class="panel-title">Prompt Sets</h2>
        <span class="item-count">{{ promptSets().length }}</span>
      </div>
      <button class="action-btn primary" (click)="openCreateDialog()">+ New</button>
    </div>

    <div class="panel-content">
      @if (promptSets().length === 0) {
        <div class="empty-state">
          <span class="empty-icon">✨</span>
          <p>No prompt sets</p>
          <span class="empty-hint">Create your first prompt set</span>
        </div>
      } @else {
        <div class="sets-list">
          @for (set of promptSets(); track set.id) {
            <div class="set-item"
                 [class.selected]="selectedPromptSetId() === set.id"
                 (click)="selectPromptSet(set.id)">
              <span class="set-name">{{ set.name }}</span>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Right Panel: Editor -->
  <div class="editor-panel">
    @if (currentPromptSet()) {
      <div class="panel-header">
        <h2 class="panel-title">Edit Prompt Set</h2>
        <div class="header-actions">
          <button class="action-btn" (click)="confirmDelete(selectedPromptSetId()!)">Delete</button>
          <button class="action-btn primary" (click)="saveCurrentPromptSet()">Save Changes</button>
        </div>
      </div>

      <div class="panel-content">
        <div class="editor-form">
          <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text"
                   class="form-input"
                   [ngModel]="editName()"
                   (ngModelChange)="editName.set($event)"
                   placeholder="Prompt set name...">
          </div>

          <div class="form-group">
            <div class="form-label-row">
              <label class="form-label">
                Editorial Prompt
                <span class="label-hint">Must contain &#123;subject&#125; placeholder</span>
              </label>
            </div>
            <textarea class="form-textarea large"
                      [ngModel]="editEditorialPrompt()"
                      (ngModelChange)="editEditorialPrompt.set($event)"
                      placeholder="Your editorial voice, tone, and approach. Use {subject} where the content should be inserted..."
                      rows="8"></textarea>
          </div>

          <div class="form-group">
            <div class="form-label-row">
              <label class="form-label">Instructions Prompt</label>
              <button class="builder-btn" (click)="openBuilderDialog()">
                Open Builder
              </button>
            </div>
            <textarea class="form-textarea"
                      [ngModel]="editInstructionsPrompt()"
                      (ngModelChange)="editInstructionsPrompt.set($event)"
                      placeholder="Instructions for what to generate (titles, descriptions, tags, etc.)..."
                      rows="6"></textarea>
            <span class="form-hint">What the AI should generate and how (e.g., TITLES: 10 options, 45-70 chars)</span>
          </div>

          <div class="form-group">
            <label class="form-label">Description Links</label>
            <textarea class="form-textarea"
                      [ngModel]="editDescriptionLinks()"
                      (ngModelChange)="editDescriptionLinks.set($event)"
                      placeholder="Links to be appended to descriptions (not sent to AI)..."
                      rows="6"></textarea>
            <span class="form-hint">Links appended after AI generation (e.g., social media, affiliate links)</span>
          </div>
        </div>
      </div>
    } @else {
      <div class="empty-state">
        <span class="empty-icon">✨</span>
        <p>Select a prompt set</p>
        <span class="empty-hint">Choose from the list or create a new one</span>
        <button class="action-btn primary" style="margin-top: 16px" (click)="openCreateDialog()">
          Create First Set
        </button>
      </div>
    }
  </div>
</div>

<!-- Create Dialog -->
@if (showCreateDialog()) {
  <div class="dialog-overlay" (click)="closeCreateDialog()">
    <div class="dialog-card" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h3>Create New Prompt Set</h3>
        <button class="dialog-close" (click)="closeCreateDialog()">✕</button>
      </div>
      <div class="dialog-body">
        <div class="form-group">
          <label class="form-label">Name</label>
          <input type="text"
                 class="form-input"
                 [ngModel]="newPromptSetName()"
                 (ngModelChange)="newPromptSetName.set($event)"
                 placeholder="e.g., YouTube - My Channel">
        </div>
      </div>
      <div class="dialog-actions">
        <button class="action-btn" (click)="closeCreateDialog()">Cancel</button>
        <button class="action-btn primary" (click)="createNewPromptSet()" [disabled]="!newPromptSetName().trim()">
          Create
        </button>
      </div>
    </div>
  </div>
}

<!-- Delete Confirmation Dialog -->
@if (showDeleteDialog()) {
  <div class="dialog-overlay" (click)="showDeleteDialog.set(false)">
    <div class="dialog-card" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h3>Delete Prompt Set?</h3>
        <button class="dialog-close" (click)="showDeleteDialog.set(false)">✕</button>
      </div>
      <div class="dialog-body">
        <p class="dialog-message">Are you sure you want to delete this prompt set? This action cannot be undone.</p>
      </div>
      <div class="dialog-actions">
        <button class="action-btn" (click)="showDeleteDialog.set(false)">Cancel</button>
        <button class="action-btn danger" (click)="deletePromptSet()">Delete</button>
      </div>
    </div>
  </div>
}

<!-- Instructions Builder Dialog -->
@if (showBuilderDialog()) {
  <div class="dialog-overlay" (click)="closeBuilderDialog()">
    <div class="dialog-card builder-dialog" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <div>
          <h3>Instructions Builder</h3>
          <p class="dialog-subtitle">Select what you want to generate and configure each option</p>
        </div>
        <button class="dialog-close" (click)="closeBuilderDialog()">✕</button>
      </div>
      <div class="dialog-body">
        <div class="builder-grid">
          <!-- Titles -->
          <div class="builder-item" [class.enabled]="builderTitles().enabled">
            <label class="builder-checkbox">
              <input type="checkbox"
                     [checked]="builderTitles().enabled"
                     (change)="updateBuilderOption('builderTitles', 'enabled', !builderTitles().enabled)">
              <span class="checkmark"></span>
              <span class="builder-label">Titles</span>
            </label>
            @if (builderTitles().enabled) {
              <div class="builder-options">
                <div class="option-field">
                  <label>Count</label>
                  <input type="number" [ngModel]="builderTitles().count"
                         (ngModelChange)="updateBuilderOption('builderTitles', 'count', $event)">
                </div>
                <div class="option-field">
                  <label>Min Length</label>
                  <input type="number" [ngModel]="builderTitles().minLength"
                         (ngModelChange)="updateBuilderOption('builderTitles', 'minLength', $event)">
                </div>
                <div class="option-field">
                  <label>Max Length</label>
                  <input type="number" [ngModel]="builderTitles().maxLength"
                         (ngModelChange)="updateBuilderOption('builderTitles', 'maxLength', $event)">
                </div>
              </div>
            }
          </div>

          <!-- Description -->
          <div class="builder-item" [class.enabled]="builderDescription().enabled">
            <label class="builder-checkbox">
              <input type="checkbox"
                     [checked]="builderDescription().enabled"
                     (change)="updateBuilderOption('builderDescription', 'enabled', !builderDescription().enabled)">
              <span class="checkmark"></span>
              <span class="builder-label">Description</span>
            </label>
            @if (builderDescription().enabled) {
              <div class="builder-options">
                <div class="option-field">
                  <label>Min Words</label>
                  <input type="number" [ngModel]="builderDescription().minWords"
                         (ngModelChange)="updateBuilderOption('builderDescription', 'minWords', $event)">
                </div>
                <div class="option-field">
                  <label>Max Words</label>
                  <input type="number" [ngModel]="builderDescription().maxWords"
                         (ngModelChange)="updateBuilderOption('builderDescription', 'maxWords', $event)">
                </div>
              </div>
            }
          </div>

          <!-- Tags -->
          <div class="builder-item" [class.enabled]="builderTags().enabled">
            <label class="builder-checkbox">
              <input type="checkbox"
                     [checked]="builderTags().enabled"
                     (change)="updateBuilderOption('builderTags', 'enabled', !builderTags().enabled)">
              <span class="checkmark"></span>
              <span class="builder-label">Tags</span>
            </label>
            @if (builderTags().enabled) {
              <div class="builder-options">
                <div class="option-field">
                  <label>Count</label>
                  <input type="number" [ngModel]="builderTags().count"
                         (ngModelChange)="updateBuilderOption('builderTags', 'count', $event)">
                </div>
              </div>
            }
          </div>

          <!-- Hashtags -->
          <div class="builder-item" [class.enabled]="builderHashtags().enabled">
            <label class="builder-checkbox">
              <input type="checkbox"
                     [checked]="builderHashtags().enabled"
                     (change)="updateBuilderOption('builderHashtags', 'enabled', !builderHashtags().enabled)">
              <span class="checkmark"></span>
              <span class="builder-label">Hashtags</span>
            </label>
            @if (builderHashtags().enabled) {
              <div class="builder-options">
                <div class="option-field">
                  <label>Count</label>
                  <input type="number" [ngModel]="builderHashtags().count"
                         (ngModelChange)="updateBuilderOption('builderHashtags', 'count', $event)">
                </div>
              </div>
            }
          </div>

          <!-- Thumbnail Text -->
          <div class="builder-item" [class.enabled]="builderThumbnailText().enabled">
            <label class="builder-checkbox">
              <input type="checkbox"
                     [checked]="builderThumbnailText().enabled"
                     (change)="updateBuilderOption('builderThumbnailText', 'enabled', !builderThumbnailText().enabled)">
              <span class="checkmark"></span>
              <span class="builder-label">Thumbnail Text</span>
            </label>
            @if (builderThumbnailText().enabled) {
              <div class="builder-options">
                <div class="option-field">
                  <label>Count</label>
                  <input type="number" [ngModel]="builderThumbnailText().count"
                         (ngModelChange)="updateBuilderOption('builderThumbnailText', 'count', $event)">
                </div>
                <div class="option-field">
                  <label>Max Words</label>
                  <input type="number" [ngModel]="builderThumbnailText().maxWords"
                         (ngModelChange)="updateBuilderOption('builderThumbnailText', 'maxWords', $event)">
                </div>
              </div>
            }
          </div>

          <!-- Chapters -->
          <div class="builder-item" [class.enabled]="builderChapters().enabled">
            <label class="builder-checkbox">
              <input type="checkbox"
                     [checked]="builderChapters().enabled"
                     (change)="updateBuilderOption('builderChapters', 'enabled', !builderChapters().enabled)">
              <span class="checkmark"></span>
              <span class="builder-label">Chapters</span>
            </label>
            @if (builderChapters().enabled) {
              <div class="builder-options">
                <div class="option-field">
                  <label>Min Count</label>
                  <input type="number" [ngModel]="builderChapters().minCount"
                         (ngModelChange)="updateBuilderOption('builderChapters', 'minCount', $event)">
                </div>
                <div class="option-field">
                  <label>Max Count</label>
                  <input type="number" [ngModel]="builderChapters().maxCount"
                         (ngModelChange)="updateBuilderOption('builderChapters', 'maxCount', $event)">
                </div>
              </div>
            }
          </div>
        </div>

        <!-- Preview -->
        <div class="builder-preview">
          <h4>Preview</h4>
          <pre>{{ generateBuilderPreview() || 'No options selected' }}</pre>
        </div>
      </div>
      <div class="dialog-actions">
        <button class="action-btn" (click)="closeBuilderDialog()">Cancel</button>
        <button class="action-btn primary" (click)="insertBuilderInstructions()">
          Insert into Instructions
        </button>
      </div>
    </div>
  </div>
}
